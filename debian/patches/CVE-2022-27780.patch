From 25738a37307051b0c9d1b5b2095d1028a09e764a Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Tue, 3 May 2022 09:19:15 +0200
Subject: [PATCH] urlapi: reject percent-decoding host name into separator
 bytes

CVE-2022-27780

Reported-by: Axel Chong
Bug: https://curl.se/docs/CVE-2022-27780.html
---
 lib/urlapi.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

--- a/lib/urlapi.c
+++ b/lib/urlapi.c
@@ -688,8 +688,8 @@ static CURLUcode hostname_check(struct C
 #endif
   }
   else {
-    /* letters from the second string is not ok */
-    len = strcspn(hostname, " \r\n");
+    /* letters from the second string are not ok */
+    len = strcspn(hostname, " \r\n\t/:#?!@");
     if(hlen != len)
       /* hostname with bad content */
       return CURLUE_BAD_HOSTNAME;
